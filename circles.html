<html>
<head>
	<title>Ruby - 2D Animation</title>
	<style type="text/css">
    html, body { height: 100%; overflow: hidden; }
    body { padding: 0; margin: 0; }
    #circles { height: 100%; }
  </style>
	<script type="text/javascript" charset="utf-8">
	 window.DLR = {}
	 DLR.settings = {id: 'circles', width:'100%', height:'100%'}
	</script>
	<script src="http://mschnlnine.vo.llnwd.net/d1/dlr-20091120.js" type="text/javascript"></script>
</head>
<body>
  <script type="text/ruby" src="repl.rb"></script>
  <script type="text/ruby" src="wpf_ext.rb"></script>
  <script type="text/ruby" src="bouncer.rb"></script>
  <script type="text/ruby" src="sketch.rb"></script>
  <script type="text/ruby">
    class Circles < Sketch

      # called one at the creation of this animation
      def setup(container)
        @container = container
        @draw_on = false
        @d = @d_start = 10
        @color_set = [[255,0,  113,118],
                      [255,0,  173,239],
                      [255,68, 199,244],
                      [255,157,220,249],
                      [255,255,235,149]]
      end

      # the following methods are event hooks

      def mouse_pressed(s,e)
        @draw_on = true
        @mouse = e
      end

      def mouse_released(s,e)
        @draw_on = false
        @d = @d_start
      end

      def mouse_dragged(s,e)
        @mouse = e
        @d += 2
      end

      # called for each frame of animation

      def draw
        if @draw_on
          mouse_pos = @mouse.get_position @container
          my_circle(mouse_pos.x, mouse_pos.y, @d)
        end
        if @bounce_on
          canvas.children.each{ |obj| obj.tag.update(obj) if obj.tag }
        end
      end 

      # helper methods

      def random_color
        @color_set[rand(@color_set.size)]
      end

      def random_transparency
        rand
      end

      def my_circle(x,y,d)
        cir = Ellipse.new
        cir.height = cir.width = d
        brush = SolidColorBrush.new(Color.from_argb(*random_color))
        brush.opacity = random_transparency
        cir.fill = brush
        stroke_brush = SolidColorBrush.new(Color.from_argb(*random_color))
        stroke_brush.opacity = random_transparency
        cir.stroke = stroke_brush
        cir.stroke_thickness = 10
        @container.children.add cir
        cir.tag = Bouncer.new(rand(10)-5, rand(10)-5, @container)
        Canvas.set_left cir, x-d/2
        Canvas.set_top cir, y-d/2
      end
      
      def toggle_bounce
        @bounce_on = !@bounce_on
      end
    end


    Circles.create_sketch
  </script>
</body>
</html>
